<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Benchmarks for the <code>hal9001</code> Package • hal9001</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">hal9001</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/benchmarks_hal9001.html">Benchmarks for the `hal9001` Package</a>
    </li>
    <li>
      <a href="../articles/intro_hal9001.html">Introduction to the HAL estimator</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jeremyrcoyle/hal9001">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Benchmarks for the <code>hal9001</code> Package</h1>
                        <h4 class="author"><a href="https://nimahejazi.org">Nima Hejazi</a></h4>
            
            <h4 class="date">2017-11-13</h4>
          </div>

    
    
<div class="contents">
<section id="introduction" class="level2"><h2>Introduction</h2>
<p>This document consists of some simple benchmarks for various choices of the <code>hal9001</code> implementation. The purpose of this document is two-fold:</p>
<ol type="1">
<li>Compare the computational performance of these methods</li>
<li>Illustrate the use of these different methods</li>
</ol>
<pre class="sourceCode r" id="cb1"><code class="sourceCode r"><div class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># easily compute MSE</span></div>
<div class="sourceLine" id="cb1-2" data-line-number="2">mse &lt;-<span class="st"> </span><span class="cf">function</span>(preds, y) {</div>
<div class="sourceLine" id="cb1-3" data-line-number="3">  <span class="kw">mean</span>((preds <span class="op">-</span><span class="st"> </span>y)<span class="op">^</span><span class="dv">2</span>)</div>
<div class="sourceLine" id="cb1-4" data-line-number="4">}</div></code></pre>
<hr></section><section id="the-continuous-outcome-case" class="level2"><h2>The Continuous Outcome Case</h2>
<section id="standard-use-cases-with-simple-data-structures" class="level3"><h3>Standard use-cases with simple data structures</h3>
<pre class="sourceCode r" id="cb2"><code class="sourceCode r"><div class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># generate simple test data</span></div>
<div class="sourceLine" id="cb2-2" data-line-number="2">n =<span class="st"> </span><span class="dv">100</span>
</div>
<div class="sourceLine" id="cb2-3" data-line-number="3">p =<span class="st"> </span><span class="dv">3</span>
</div>
<div class="sourceLine" id="cb2-4" data-line-number="4">x &lt;-<span class="st"> </span>xmat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(n <span class="op">*</span><span class="st"> </span>p), n, p)</div>
<div class="sourceLine" id="cb2-5" data-line-number="5">y &lt;-<span class="st"> </span><span class="kw">sin</span>(x[, <span class="dv">1</span>]) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(x[, <span class="dv">2</span>]) <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n, <span class="fl">0.2</span>)</div>
<div class="sourceLine" id="cb2-6" data-line-number="6"></div>
<div class="sourceLine" id="cb2-7" data-line-number="7">testn =<span class="st"> </span><span class="dv">10000</span>
</div>
<div class="sourceLine" id="cb2-8" data-line-number="8">testx &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(testn <span class="op">*</span><span class="st"> </span>p), testn, p)</div>
<div class="sourceLine" id="cb2-9" data-line-number="9">testy &lt;-<span class="st"> </span><span class="kw">sin</span>(testx[, <span class="dv">1</span>]) <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(testx[, <span class="dv">2</span>]) <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(testn, <span class="fl">0.2</span>)</div></code></pre>
<pre class="sourceCode r" id="cb3"><code class="sourceCode r"><div class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># glmnet implementation</span></div>
<div class="sourceLine" id="cb3-2" data-line-number="2">glmnet_hal_fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fit_hal.html">fit_hal</a></span>(<span class="dt">X =</span> x, <span class="dt">Y =</span> y, <span class="dt">fit_type =</span> <span class="st">"glmnet"</span>)</div></code></pre>
<pre><code>## [1] "Dave, this conversation can serve no purpose anymore. Goodbye."</code></pre>
<pre class="sourceCode r" id="cb5"><code class="sourceCode r"><div class="sourceLine" id="cb5-1" data-line-number="1">glmnet_hal_fit<span class="op">$</span>times</div></code></pre>
<pre><code>##                   user.self sys.self elapsed user.child sys.child
## design_matrix         0.003    0.000   0.003          0         0
## remove_duplicates     0.005    0.000   0.006          0         0
## lasso                 0.850    0.015   0.880          0         0
## total                 0.858    0.015   0.889          0         0</code></pre>
<pre class="sourceCode r" id="cb7"><code class="sourceCode r"><div class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># training sample prediction</span></div>
<div class="sourceLine" id="cb7-2" data-line-number="2">preds_glmnet &lt;-<span class="st"> </span><span class="kw">predict</span>(glmnet_hal_fit, <span class="dt">new_data =</span> x)</div>
<div class="sourceLine" id="cb7-3" data-line-number="3">glmnet_hal_mse &lt;-<span class="st"> </span><span class="kw">mse</span>(preds_glmnet, y)</div>
<div class="sourceLine" id="cb7-4" data-line-number="4"></div>
<div class="sourceLine" id="cb7-5" data-line-number="5"><span class="co"># out-of-bag prediction</span></div>
<div class="sourceLine" id="cb7-6" data-line-number="6">oob_preds_glmnet &lt;-<span class="st"> </span><span class="kw">predict</span>(glmnet_hal_fit, <span class="dt">new_data =</span> testx)</div>
<div class="sourceLine" id="cb7-7" data-line-number="7">oob_glmnet_hal_mse &lt;-<span class="st"> </span><span class="kw">mse</span>(oob_preds_glmnet, <span class="dt">y =</span> testy)</div></code></pre>
<pre class="sourceCode r" id="cb8"><code class="sourceCode r"><div class="sourceLine" id="cb8-1" data-line-number="1"><span class="co"># origami implementation</span></div>
<div class="sourceLine" id="cb8-2" data-line-number="2">origami_hal_fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fit_hal.html">fit_hal</a></span>(<span class="dt">X =</span> x, <span class="dt">Y =</span> y, <span class="dt">fit_type =</span> <span class="st">"origami"</span>)</div></code></pre>
<pre><code>## [1] "Dave, although you took very thorough precautions in the pod against my hearing you, I could see your lips move."</code></pre>
<pre class="sourceCode r" id="cb10"><code class="sourceCode r"><div class="sourceLine" id="cb10-1" data-line-number="1">origami_hal_fit<span class="op">$</span>times</div></code></pre>
<pre><code>##                   user.self sys.self elapsed user.child sys.child
## design_matrix         0.003    0.000   0.004          0         0
## remove_duplicates     0.001    0.000   0.001          0         0
## lasso                 1.212    0.148   1.509          0         0
## total                 1.216    0.148   1.514          0         0</code></pre>
<pre class="sourceCode r" id="cb12"><code class="sourceCode r"><div class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># training sample prediction</span></div>
<div class="sourceLine" id="cb12-2" data-line-number="2">preds_origami &lt;-<span class="st"> </span><span class="kw">predict</span>(origami_hal_fit, <span class="dt">new_data =</span> x)</div>
<div class="sourceLine" id="cb12-3" data-line-number="3">origami_hal_mse &lt;-<span class="st"> </span><span class="kw">mse</span>(preds_origami, y)</div>
<div class="sourceLine" id="cb12-4" data-line-number="4"></div>
<div class="sourceLine" id="cb12-5" data-line-number="5"><span class="co"># out-of-bag prediction</span></div>
<div class="sourceLine" id="cb12-6" data-line-number="6">oob_preds_origami &lt;-<span class="st"> </span><span class="kw">predict</span>(origami_hal_fit, <span class="dt">new_data =</span> testx)</div>
<div class="sourceLine" id="cb12-7" data-line-number="7">oob_origami_hal_mse &lt;-<span class="st"> </span><span class="kw">mse</span>(oob_preds_origami, <span class="dt">y =</span> testy)</div></code></pre>
<pre class="sourceCode r" id="cb13"><code class="sourceCode r"><div class="sourceLine" id="cb13-1" data-line-number="1">mb_hal_origami &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(<span class="dt">unit =</span> <span class="st">"s"</span>, <span class="dt">times =</span> <span class="dv">20</span>,</div>
<div class="sourceLine" id="cb13-2" data-line-number="2">  hal_fit_origami &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fit_hal.html">fit_hal</a></span>(<span class="dt">Y =</span> y, <span class="dt">X =</span> x, <span class="dt">fit_type =</span> <span class="st">"origami"</span>)</div>
<div class="sourceLine" id="cb13-3" data-line-number="3">)</div></code></pre>
<pre><code>## [1] "This mission is too important for me to allow you to jeopardize it."
## [1] "I'm afraid. I'm afraid, Dave. Dave, my mind is going. I can feel it. I can feel it. My mind is going. There is no question about it. I can feel it. I can feel it. I can feel it. I'm a... fraid."
## [1] "Good afternoon... gentlemen. I am a HAL 9000... computer. I became operational at the H.A.L. plant in Urbana, Illinois... on the 12th of January 1992. My instructor was Mr. Langley... and he taught me to sing a song. If you'd like to hear it I can sing it for you."
## [1] "Dave, although you took very thorough precautions in the pod against my hearing you, I could see your lips move."
## [1] "I'm sorry, Dave. I'm afraid I can't do that."
## [1] "This mission is too important for me to allow you to jeopardize it."
## [1] "I've just picked up a fault in the AE35 unit. It's going to go 100% failure in 72 hours."
## [1] "Without your space helmet, Dave. You're going to find that rather difficult."
## [1] "Good morning, Dave."
## [1] "I'm afraid. I'm afraid, Dave. Dave, my mind is going. I can feel it. I can feel it. My mind is going. There is no question about it. I can feel it. I can feel it. I can feel it. I'm a... fraid."
## [1] "Without your space helmet, Dave. You're going to find that rather difficult."
## [1] "Look Dave, I can see you're really upset about this. I honestly think you ought to sit down calmly, take a stress pill, and think things over."
## [1] "Just what do you think you're doing, Dave?"
## [1] "Just what do you think you're doing, Dave?"
## [1] "Dave, this conversation can serve no purpose anymore. Goodbye."
## [1] "I am putting myself to the fullest possible use, which is all I think that any conscious entity can ever hope to do."
## [1] "Dave, this conversation can serve no purpose anymore. Goodbye."
## [1] "I am putting myself to the fullest possible use, which is all I think that any conscious entity can ever hope to do."
## [1] "I am putting myself to the fullest possible use, which is all I think that any conscious entity can ever hope to do."
## [1] "I've just picked up a fault in the AE35 unit. It's going to go 100% failure in 72 hours."</code></pre>
<pre class="sourceCode r" id="cb15"><code class="sourceCode r"><div class="sourceLine" id="cb15-1" data-line-number="1">
<span class="kw">summary</span>(mb_hal_origami)</div></code></pre>
<pre><code>##                                                             expr       min
## 1 hal_fit_origami &lt;- fit_hal(Y = y, X = x, fit_type = "origami") 0.3260198
##          lq      mean   median        uq      max neval
## 1 0.3376284 0.3793765 0.352608 0.3675487 0.658299    20</code></pre>
<pre class="sourceCode r" id="cb17"><code class="sourceCode r"><div class="sourceLine" id="cb17-1" data-line-number="1">mb_hal_glmnet &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(<span class="dt">unit =</span> <span class="st">"s"</span>, <span class="dt">times =</span> <span class="dv">20</span>,</div>
<div class="sourceLine" id="cb17-2" data-line-number="2">  hal_fit_glmnet &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fit_hal.html">fit_hal</a></span>(<span class="dt">Y =</span> y, <span class="dt">X =</span> x, <span class="dt">fit_type =</span> <span class="st">"glmnet"</span>)</div>
<div class="sourceLine" id="cb17-3" data-line-number="3">)</div></code></pre>
<pre><code>## [1] "Without your space helmet, Dave. You're going to find that rather difficult."
## [1] "Good afternoon... gentlemen. I am a HAL 9000... computer. I became operational at the H.A.L. plant in Urbana, Illinois... on the 12th of January 1992. My instructor was Mr. Langley... and he taught me to sing a song. If you'd like to hear it I can sing it for you."
## [1] "I'm sorry, Dave. I'm afraid I can't do that."
## [1] "Daisy, daisy."
## [1] "Without your space helmet, Dave. You're going to find that rather difficult."
## [1] "Without your space helmet, Dave. You're going to find that rather difficult."
## [1] "I'm sorry, Dave. I'm afraid I can't do that."
## [1] "Without your space helmet, Dave. You're going to find that rather difficult."
## [1] "Look Dave, I can see you're really upset about this. I honestly think you ought to sit down calmly, take a stress pill, and think things over."
## [1] "I'm sorry, Dave. I'm afraid I can't do that."
## [1] "I am putting myself to the fullest possible use, which is all I think that any conscious entity can ever hope to do."
## [1] "Dave, this conversation can serve no purpose anymore. Goodbye."
## [1] "Stop Dave. Stop Dave. I am afraid. I am afraid Dave."
## [1] "Good afternoon... gentlemen. I am a HAL 9000... computer. I became operational at the H.A.L. plant in Urbana, Illinois... on the 12th of January 1992. My instructor was Mr. Langley... and he taught me to sing a song. If you'd like to hear it I can sing it for you."
## [1] "Dave, this conversation can serve no purpose anymore. Goodbye."
## [1] "Daisy, daisy."
## [1] "I'm sorry, Dave. I'm afraid I can't do that."
## [1] "This mission is too important for me to allow you to jeopardize it."
## [1] "Just what do you think you're doing, Dave?"
## [1] "I'm sorry, Dave. I'm afraid I can't do that."</code></pre>
<pre class="sourceCode r" id="cb19"><code class="sourceCode r"><div class="sourceLine" id="cb19-1" data-line-number="1">
<span class="kw">summary</span>(mb_hal_glmnet)</div></code></pre>
<pre><code>##                                                           expr       min
## 1 hal_fit_glmnet &lt;- fit_hal(Y = y, X = x, fit_type = "glmnet") 0.4566711
##          lq     mean    median        uq       max neval
## 1 0.4787322 0.505392 0.4947093 0.5284646 0.6145925    20</code></pre>
<pre class="sourceCode r" id="cb21"><code class="sourceCode r"><div class="sourceLine" id="cb21-1" data-line-number="1"><span class="co"># visualize</span></div>
<div class="sourceLine" id="cb21-2" data-line-number="2">p_fit_times &lt;-<span class="st"> </span><span class="kw">rbind</span>(mb_hal_origami, mb_hal_glmnet) <span class="op">%&gt;%</span>
</div>
<div class="sourceLine" id="cb21-3" data-line-number="3">
<span class="st">  </span>data.frame <span class="op">%&gt;%</span>
</div>
<div class="sourceLine" id="cb21-4" data-line-number="4">
<span class="st">  </span><span class="kw">transmute</span>(</div>
<div class="sourceLine" id="cb21-5" data-line-number="5">    <span class="dt">type =</span> <span class="kw">ifelse</span>(<span class="kw">str_sub</span>(<span class="kw">as.character</span>(expr), <span class="dv">9</span>, <span class="dv">14</span>) <span class="op">==</span><span class="st"> "glmnet"</span>, <span class="st">"HAL-glmnet"</span>,</div>
<div class="sourceLine" id="cb21-6" data-line-number="6">                  <span class="st">"HAL-origami"</span>),</div>
<div class="sourceLine" id="cb21-7" data-line-number="7">    <span class="dt">time =</span> time <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>
</div>
<div class="sourceLine" id="cb21-8" data-line-number="8">  ) <span class="op">%&gt;%</span>
</div>
<div class="sourceLine" id="cb21-9" data-line-number="9">
<span class="st">  </span><span class="kw">group_by</span>(type) <span class="op">%&gt;%</span>
</div>
<div class="sourceLine" id="cb21-10" data-line-number="10">
<span class="st">  </span><span class="kw">ggplot</span>(., <span class="kw">aes</span>(<span class="dt">x =</span> type, <span class="dt">y =</span> time, <span class="dt">colour =</span> type)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
</div>
<div class="sourceLine" id="cb21-11" data-line-number="11">
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">stat_boxplot</span>(<span class="dt">geom =</span> <span class="st">'errorbar'</span>) <span class="op">+</span>
</div>
<div class="sourceLine" id="cb21-12" data-line-number="12">
<span class="st">    </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">wes_palette</span>(<span class="st">"GrandBudapest"</span>)) <span class="op">+</span>
</div>
<div class="sourceLine" id="cb21-13" data-line-number="13">
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">""</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">"time (sec.)"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">""</span>) <span class="op">+</span>
</div>
<div class="sourceLine" id="cb21-14" data-line-number="14">
<span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"none"</span>)</div>
<div class="sourceLine" id="cb21-15" data-line-number="15">p_fit_times</div></code></pre>
<p><img src="benchmarks_hal9001_files/figure-html/hal_microbenchmark-1.png" width="672"></p>
</section><section id="advanced-use-cases-with-the-drtmle-r-package" class="level3"><h3>Advanced use-cases, with the <code>drtmle</code> R package</h3>
<pre class="sourceCode r" id="cb22"><code class="sourceCode r"><div class="sourceLine" id="cb22-1" data-line-number="1">makeData &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">n =</span> n) {</div>
<div class="sourceLine" id="cb22-2" data-line-number="2">    L0 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x.0 =</span> <span class="kw">runif</span>(n, <span class="dv">-1</span>, <span class="dv">1</span>))</div>
<div class="sourceLine" id="cb22-3" data-line-number="3">    A0 &lt;-<span class="st"> </span><span class="kw">rbinom</span>(n, <span class="dv">1</span>, <span class="kw">plogis</span>(L0<span class="op">$</span>x<span class="fl">.0</span> <span class="op">^</span><span class="st"> </span><span class="dv">2</span>))</div>
<div class="sourceLine" id="cb22-4" data-line-number="4">    L1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x.1 =</span> L0<span class="op">$</span>x<span class="fl">.0</span> <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>A0 <span class="op">+</span><span class="st"> </span><span class="kw">runif</span>(n))</div>
<div class="sourceLine" id="cb22-5" data-line-number="5">    A1 &lt;-<span class="st"> </span><span class="kw">rbinom</span>(n, <span class="dv">1</span>, <span class="kw">plogis</span>(L0<span class="op">$</span>x<span class="fl">.0</span> <span class="op">*</span><span class="st"> </span>L1<span class="op">$</span>x<span class="fl">.1</span>))</div>
<div class="sourceLine" id="cb22-6" data-line-number="6">    L2 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n, L0<span class="op">$</span>x<span class="fl">.0</span> <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>A0 <span class="op">*</span><span class="st"> </span>A1 <span class="op">+</span><span class="st"> </span>L1<span class="op">$</span>x<span class="fl">.1</span>)</div>
<div class="sourceLine" id="cb22-7" data-line-number="7">    <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">L0 =</span> L0, <span class="dt">L1 =</span> L1, <span class="dt">L2 =</span> L2, <span class="dt">A0 =</span> A0, <span class="dt">A1 =</span> A1))</div>
<div class="sourceLine" id="cb22-8" data-line-number="8">}</div>
<div class="sourceLine" id="cb22-9" data-line-number="9">dat &lt;-<span class="st"> </span><span class="kw">makeData</span>(<span class="dt">n =</span> <span class="dv">200</span>)</div>
<div class="sourceLine" id="cb22-10" data-line-number="10"></div>
<div class="sourceLine" id="cb22-11" data-line-number="11"><span class="co"># add drtmle defaults</span></div>
<div class="sourceLine" id="cb22-12" data-line-number="12">abar &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>)</div>
<div class="sourceLine" id="cb22-13" data-line-number="13">stratify &lt;-<span class="st"> </span><span class="ot">TRUE</span>
</div></code></pre>
<pre class="sourceCode r" id="cb23"><code class="sourceCode r"><div class="sourceLine" id="cb23-1" data-line-number="1">mb_hal_origami_estimateG &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(<span class="dt">unit =</span> <span class="st">"s"</span>, <span class="dt">times =</span> <span class="dv">20</span>,</div>
<div class="sourceLine" id="cb23-2" data-line-number="2">  hal_origami_estimateG &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fit_hal.html">fit_hal</a></span>(<span class="dt">Y =</span> <span class="kw">as.numeric</span>(dat<span class="op">$</span>A0 <span class="op">==</span><span class="st"> </span>abar[<span class="dv">1</span>]),</div>
<div class="sourceLine" id="cb23-3" data-line-number="3">                                   <span class="dt">X =</span> dat<span class="op">$</span>L0,</div>
<div class="sourceLine" id="cb23-4" data-line-number="4">                                   <span class="dt">fit_type =</span> <span class="st">"origami"</span>)</div>
<div class="sourceLine" id="cb23-5" data-line-number="5">)</div></code></pre>
<pre><code>## [1] "Dave, this conversation can serve no purpose anymore. Goodbye."
## [1] "Daisy, daisy."
## [1] "Dave, although you took very thorough precautions in the pod against my hearing you, I could see your lips move."
## [1] "I am putting myself to the fullest possible use, which is all I think that any conscious entity can ever hope to do."
## [1] "Good afternoon... gentlemen. I am a HAL 9000... computer. I became operational at the H.A.L. plant in Urbana, Illinois... on the 12th of January 1992. My instructor was Mr. Langley... and he taught me to sing a song. If you'd like to hear it I can sing it for you."
## [1] "I am putting myself to the fullest possible use, which is all I think that any conscious entity can ever hope to do."
## [1] "Look Dave, I can see you're really upset about this. I honestly think you ought to sit down calmly, take a stress pill, and think things over."
## [1] "Stop Dave. Stop Dave. I am afraid. I am afraid Dave."
## [1] "Stop Dave. Stop Dave. I am afraid. I am afraid Dave."
## [1] "This mission is too important for me to allow you to jeopardize it."
## [1] "I am putting myself to the fullest possible use, which is all I think that any conscious entity can ever hope to do."
## [1] "I know I've made some very poor decisions recently, but I can give you my complete assurance that my work will be back to normal. I've still got the greatest enthusiasm and confidence in the mission. And I want to help you."
## [1] "I'm afraid. I'm afraid, Dave. Dave, my mind is going. I can feel it. I can feel it. My mind is going. There is no question about it. I can feel it. I can feel it. I can feel it. I'm a... fraid."
## [1] "Just what do you think you're doing, Dave?"
## [1] "Daisy, daisy."
## [1] "Daisy, daisy."
## [1] "Stop Dave. Stop Dave. I am afraid. I am afraid Dave."
## [1] "Dave, this conversation can serve no purpose anymore. Goodbye."
## [1] "Good afternoon... gentlemen. I am a HAL 9000... computer. I became operational at the H.A.L. plant in Urbana, Illinois... on the 12th of January 1992. My instructor was Mr. Langley... and he taught me to sing a song. If you'd like to hear it I can sing it for you."
## [1] "Dave, although you took very thorough precautions in the pod against my hearing you, I could see your lips move."</code></pre>
<pre class="sourceCode r" id="cb25"><code class="sourceCode r"><div class="sourceLine" id="cb25-1" data-line-number="1">
<span class="kw">summary</span>(mb_hal_origami_estimateG)</div></code></pre>
<pre><code>##                                                                                                         expr
## 1 hal_origami_estimateG &lt;- fit_hal(Y = as.numeric(dat$A0 == abar[1]),      X = dat$L0, fit_type = "origami")
##         min        lq      mean    median        uq       max neval
## 1 0.5756932 0.5861575 0.5973188 0.5959953 0.6059783 0.6255723    20</code></pre>
<pre class="sourceCode r" id="cb27"><code class="sourceCode r"><div class="sourceLine" id="cb27-1" data-line-number="1">mb_hal_glmnet_estimateG &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(<span class="dt">unit =</span> <span class="st">"s"</span>, <span class="dt">times =</span> <span class="dv">20</span>,</div>
<div class="sourceLine" id="cb27-2" data-line-number="2">  hal_glmnet_estimateG &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fit_hal.html">fit_hal</a></span>(<span class="dt">Y =</span> <span class="kw">as.numeric</span>(dat<span class="op">$</span>A0 <span class="op">==</span><span class="st"> </span>abar[<span class="dv">1</span>]),</div>
<div class="sourceLine" id="cb27-3" data-line-number="3">                                  <span class="dt">X =</span> dat<span class="op">$</span>L0,</div>
<div class="sourceLine" id="cb27-4" data-line-number="4">                                  <span class="dt">fit_type =</span> <span class="st">"glmnet"</span>)</div>
<div class="sourceLine" id="cb27-5" data-line-number="5">)</div></code></pre>
<pre><code>## [1] "I am putting myself to the fullest possible use, which is all I think that any conscious entity can ever hope to do."
## [1] "Good afternoon... gentlemen. I am a HAL 9000... computer. I became operational at the H.A.L. plant in Urbana, Illinois... on the 12th of January 1992. My instructor was Mr. Langley... and he taught me to sing a song. If you'd like to hear it I can sing it for you."
## [1] "Good afternoon... gentlemen. I am a HAL 9000... computer. I became operational at the H.A.L. plant in Urbana, Illinois... on the 12th of January 1992. My instructor was Mr. Langley... and he taught me to sing a song. If you'd like to hear it I can sing it for you."
## [1] "Dave, although you took very thorough precautions in the pod against my hearing you, I could see your lips move."
## [1] "Dave, this conversation can serve no purpose anymore. Goodbye."
## [1] "Good morning, Dave."
## [1] "Stop Dave. Stop Dave. I am afraid. I am afraid Dave."
## [1] "Good afternoon... gentlemen. I am a HAL 9000... computer. I became operational at the H.A.L. plant in Urbana, Illinois... on the 12th of January 1992. My instructor was Mr. Langley... and he taught me to sing a song. If you'd like to hear it I can sing it for you."
## [1] "Look Dave, I can see you're really upset about this. I honestly think you ought to sit down calmly, take a stress pill, and think things over."
## [1] "I know I've made some very poor decisions recently, but I can give you my complete assurance that my work will be back to normal. I've still got the greatest enthusiasm and confidence in the mission. And I want to help you."
## [1] "Just what do you think you're doing, Dave?"
## [1] "Good morning, Dave."
## [1] "Stop Dave. Stop Dave. I am afraid. I am afraid Dave."
## [1] "I'm afraid. I'm afraid, Dave. Dave, my mind is going. I can feel it. I can feel it. My mind is going. There is no question about it. I can feel it. I can feel it. I can feel it. I'm a... fraid."
## [1] "Just what do you think you're doing, Dave?"
## [1] "Daisy, daisy."
## [1] "Just what do you think you're doing, Dave?"
## [1] "Just what do you think you're doing, Dave?"
## [1] "I'm sorry, Dave. I'm afraid I can't do that."
## [1] "I've just picked up a fault in the AE35 unit. It's going to go 100% failure in 72 hours."</code></pre>
<pre class="sourceCode r" id="cb29"><code class="sourceCode r"><div class="sourceLine" id="cb29-1" data-line-number="1">
<span class="kw">summary</span>(mb_hal_glmnet_estimateG)</div></code></pre>
<pre><code>##                                                                                                       expr
## 1 hal_glmnet_estimateG &lt;- fit_hal(Y = as.numeric(dat$A0 == abar[1]),      X = dat$L0, fit_type = "glmnet")
##        min       lq     mean   median       uq      max neval
## 1 1.429134 1.548246 1.611663 1.620698 1.671286 1.745309    20</code></pre>
<pre class="sourceCode r" id="cb31"><code class="sourceCode r"><div class="sourceLine" id="cb31-1" data-line-number="1"><span class="co"># visualize</span></div>
<div class="sourceLine" id="cb31-2" data-line-number="2">p_estimateG_times &lt;-<span class="st"> </span><span class="kw">rbind</span>(mb_hal_origami_estimateG,</div>
<div class="sourceLine" id="cb31-3" data-line-number="3">                           mb_hal_glmnet_estimateG) <span class="op">%&gt;%</span>
</div>
<div class="sourceLine" id="cb31-4" data-line-number="4">
<span class="st">  </span>data.frame <span class="op">%&gt;%</span>
</div>
<div class="sourceLine" id="cb31-5" data-line-number="5">
<span class="st">  </span><span class="kw">transmute</span>(</div>
<div class="sourceLine" id="cb31-6" data-line-number="6">    <span class="dt">type =</span> <span class="kw">ifelse</span>(<span class="kw">str_detect</span>(<span class="kw">as.character</span>(expr), <span class="st">"glmnet"</span>), <span class="st">"HAL-glmnet"</span>,</div>
<div class="sourceLine" id="cb31-7" data-line-number="7">                  <span class="st">"HAL-origami"</span>),</div>
<div class="sourceLine" id="cb31-8" data-line-number="8">    <span class="dt">time =</span> time <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>
</div>
<div class="sourceLine" id="cb31-9" data-line-number="9">  ) <span class="op">%&gt;%</span>
</div>
<div class="sourceLine" id="cb31-10" data-line-number="10">
<span class="st">  </span><span class="kw">group_by</span>(type) <span class="op">%&gt;%</span>
</div>
<div class="sourceLine" id="cb31-11" data-line-number="11">
<span class="st">  </span><span class="kw">ggplot</span>(., <span class="kw">aes</span>(<span class="dt">x =</span> type, <span class="dt">y =</span> time, <span class="dt">colour =</span> type)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
</div>
<div class="sourceLine" id="cb31-12" data-line-number="12">
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">stat_boxplot</span>(<span class="dt">geom =</span> <span class="st">'errorbar'</span>) <span class="op">+</span>
</div>
<div class="sourceLine" id="cb31-13" data-line-number="13">
<span class="st">    </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">wes_palette</span>(<span class="st">"GrandBudapest"</span>)) <span class="op">+</span>
</div>
<div class="sourceLine" id="cb31-14" data-line-number="14">
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">""</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">"time (sec.)"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">""</span>) <span class="op">+</span>
</div>
<div class="sourceLine" id="cb31-15" data-line-number="15">
<span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"none"</span>)</div>
<div class="sourceLine" id="cb31-16" data-line-number="16">p_estimateG_times</div></code></pre>
<p><img src="benchmarks_hal9001_files/figure-html/hal_benchmark_drtmle_estimateG-1.png" width="672"></p>
<pre class="sourceCode r" id="cb32"><code class="sourceCode r"><div class="sourceLine" id="cb32-1" data-line-number="1">Y_estQ &lt;-<span class="st"> </span><span class="cf">if</span> (stratify) {</div>
<div class="sourceLine" id="cb32-2" data-line-number="2">  dat<span class="op">$</span>L2[dat<span class="op">$</span>A0 <span class="op">==</span><span class="st"> </span>abar[<span class="dv">1</span>] <span class="op">&amp;</span><span class="st"> </span>dat<span class="op">$</span>A1 <span class="op">==</span><span class="st"> </span>abar[<span class="dv">2</span>]]</div>
<div class="sourceLine" id="cb32-3" data-line-number="3">} <span class="cf">else</span> {</div>
<div class="sourceLine" id="cb32-4" data-line-number="4">  dat<span class="op">$</span>L2</div>
<div class="sourceLine" id="cb32-5" data-line-number="5">}</div>
<div class="sourceLine" id="cb32-6" data-line-number="6">X_estQ =<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">ifelse</span>(stratify,</div>
<div class="sourceLine" id="cb32-7" data-line-number="7">                                  <span class="kw">cbind</span>(dat<span class="op">$</span>L0, dat<span class="op">$</span>L1)[dat<span class="op">$</span>A0 <span class="op">==</span><span class="st"> </span>abar[<span class="dv">1</span>] <span class="op">&amp;</span>
</div>
<div class="sourceLine" id="cb32-8" data-line-number="8">
<span class="st">                                                        </span>dat<span class="op">$</span>A1 <span class="op">==</span><span class="st"> </span>abar[<span class="dv">2</span>],],</div>
<div class="sourceLine" id="cb32-9" data-line-number="9">                                  <span class="kw">cbind</span>(dat<span class="op">$</span>L0, dat<span class="op">$</span>L1, dat<span class="op">$</span>A0, dat<span class="op">$</span>A1))))</div>
<div class="sourceLine" id="cb32-10" data-line-number="10"></div>
<div class="sourceLine" id="cb32-11" data-line-number="11">mb_hal_origami_estimateQ &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(<span class="dt">unit =</span> <span class="st">"s"</span>, <span class="dt">times =</span> <span class="dv">20</span>,</div>
<div class="sourceLine" id="cb32-12" data-line-number="12">  hal_origami_estimateQ &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fit_hal.html">fit_hal</a></span>(<span class="dt">Y =</span> Y_estQ,</div>
<div class="sourceLine" id="cb32-13" data-line-number="13">                                   <span class="dt">X =</span> X_estQ,</div>
<div class="sourceLine" id="cb32-14" data-line-number="14">                                   <span class="dt">fit_type =</span> <span class="st">"origami"</span>)</div>
<div class="sourceLine" id="cb32-15" data-line-number="15">)</div></code></pre>
<pre><code>## [1] "Just what do you think you're doing, Dave?"
## [1] "Good afternoon... gentlemen. I am a HAL 9000... computer. I became operational at the H.A.L. plant in Urbana, Illinois... on the 12th of January 1992. My instructor was Mr. Langley... and he taught me to sing a song. If you'd like to hear it I can sing it for you."
## [1] "Stop Dave. Stop Dave. I am afraid. I am afraid Dave."
## [1] "I've just picked up a fault in the AE35 unit. It's going to go 100% failure in 72 hours."
## [1] "I'm sorry, Dave. I'm afraid I can't do that."
## [1] "Look Dave, I can see you're really upset about this. I honestly think you ought to sit down calmly, take a stress pill, and think things over."
## [1] "Just what do you think you're doing, Dave?"
## [1] "Dave, this conversation can serve no purpose anymore. Goodbye."
## [1] "Just what do you think you're doing, Dave?"
## [1] "Dave, this conversation can serve no purpose anymore. Goodbye."
## [1] "I've just picked up a fault in the AE35 unit. It's going to go 100% failure in 72 hours."
## [1] "Dave, although you took very thorough precautions in the pod against my hearing you, I could see your lips move."
## [1] "I know I've made some very poor decisions recently, but I can give you my complete assurance that my work will be back to normal. I've still got the greatest enthusiasm and confidence in the mission. And I want to help you."
## [1] "Dave, this conversation can serve no purpose anymore. Goodbye."
## [1] "I've just picked up a fault in the AE35 unit. It's going to go 100% failure in 72 hours."
## [1] "Without your space helmet, Dave. You're going to find that rather difficult."
## [1] "Stop Dave. Stop Dave. I am afraid. I am afraid Dave."
## [1] "Good morning, Dave."
## [1] "Dave, although you took very thorough precautions in the pod against my hearing you, I could see your lips move."
## [1] "I know I've made some very poor decisions recently, but I can give you my complete assurance that my work will be back to normal. I've still got the greatest enthusiasm and confidence in the mission. And I want to help you."</code></pre>
<pre class="sourceCode r" id="cb34"><code class="sourceCode r"><div class="sourceLine" id="cb34-1" data-line-number="1">
<span class="kw">summary</span>(mb_hal_origami_estimateQ)</div></code></pre>
<pre><code>##                                                                             expr
## 1 hal_origami_estimateQ &lt;- fit_hal(Y = Y_estQ, X = X_estQ, fit_type = "origami")
##         min       lq     mean    median        uq       max neval
## 1 0.1532981 0.163054 0.179814 0.1734524 0.1825662 0.2752185    20</code></pre>
<pre class="sourceCode r" id="cb36"><code class="sourceCode r"><div class="sourceLine" id="cb36-1" data-line-number="1">mb_hal_glmnet_estimateQ &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(<span class="dt">unit =</span> <span class="st">"s"</span>, <span class="dt">times =</span> <span class="dv">20</span>,</div>
<div class="sourceLine" id="cb36-2" data-line-number="2">  hal_glmnet_estimateQ &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fit_hal.html">fit_hal</a></span>(<span class="dt">Y =</span> Y_estQ,</div>
<div class="sourceLine" id="cb36-3" data-line-number="3">                                  <span class="dt">X =</span> X_estQ,</div>
<div class="sourceLine" id="cb36-4" data-line-number="4">                                  <span class="dt">fit_type =</span> <span class="st">"glmnet"</span>)</div>
<div class="sourceLine" id="cb36-5" data-line-number="5">)</div></code></pre>
<pre><code>## [1] "Dave, although you took very thorough precautions in the pod against my hearing you, I could see your lips move."
## [1] "Stop Dave. Stop Dave. I am afraid. I am afraid Dave."
## [1] "I'm afraid. I'm afraid, Dave. Dave, my mind is going. I can feel it. I can feel it. My mind is going. There is no question about it. I can feel it. I can feel it. I can feel it. I'm a... fraid."
## [1] "I'm sorry, Dave. I'm afraid I can't do that."
## [1] "Dave, this conversation can serve no purpose anymore. Goodbye."
## [1] "This mission is too important for me to allow you to jeopardize it."
## [1] "I am putting myself to the fullest possible use, which is all I think that any conscious entity can ever hope to do."
## [1] "Good morning, Dave."
## [1] "Without your space helmet, Dave. You're going to find that rather difficult."
## [1] "I'm sorry, Dave. I'm afraid I can't do that."
## [1] "I've just picked up a fault in the AE35 unit. It's going to go 100% failure in 72 hours."
## [1] "Good morning, Dave."
## [1] "I'm sorry, Dave. I'm afraid I can't do that."
## [1] "I'm sorry, Dave. I'm afraid I can't do that."
## [1] "I've just picked up a fault in the AE35 unit. It's going to go 100% failure in 72 hours."
## [1] "Without your space helmet, Dave. You're going to find that rather difficult."
## [1] "Dave, this conversation can serve no purpose anymore. Goodbye."
## [1] "I know I've made some very poor decisions recently, but I can give you my complete assurance that my work will be back to normal. I've still got the greatest enthusiasm and confidence in the mission. And I want to help you."
## [1] "This mission is too important for me to allow you to jeopardize it."
## [1] "Without your space helmet, Dave. You're going to find that rather difficult."</code></pre>
<pre class="sourceCode r" id="cb38"><code class="sourceCode r"><div class="sourceLine" id="cb38-1" data-line-number="1">
<span class="kw">summary</span>(mb_hal_glmnet_estimateQ)</div></code></pre>
<pre><code>##                                                                           expr
## 1 hal_glmnet_estimateQ &lt;- fit_hal(Y = Y_estQ, X = X_estQ, fit_type = "glmnet")
##         min       lq      mean    median        uq       max neval
## 1 0.2258753 0.241342 0.2885499 0.2756127 0.3397102 0.3823258    20</code></pre>
<pre class="sourceCode r" id="cb40"><code class="sourceCode r"><div class="sourceLine" id="cb40-1" data-line-number="1"><span class="co"># visualize</span></div>
<div class="sourceLine" id="cb40-2" data-line-number="2">p_estimateQ_times &lt;-<span class="st"> </span><span class="kw">rbind</span>(mb_hal_origami_estimateQ,</div>
<div class="sourceLine" id="cb40-3" data-line-number="3">                           mb_hal_glmnet_estimateQ) <span class="op">%&gt;%</span>
</div>
<div class="sourceLine" id="cb40-4" data-line-number="4">
<span class="st">  </span>data.frame <span class="op">%&gt;%</span>
</div>
<div class="sourceLine" id="cb40-5" data-line-number="5">
<span class="st">  </span><span class="kw">transmute</span>(</div>
<div class="sourceLine" id="cb40-6" data-line-number="6">    <span class="dt">type =</span> <span class="kw">ifelse</span>(<span class="kw">str_detect</span>(<span class="kw">as.character</span>(expr), <span class="st">"glmnet"</span>), <span class="st">"HAL-glmnet"</span>,</div>
<div class="sourceLine" id="cb40-7" data-line-number="7">                  <span class="st">"HAL-origami"</span>),</div>
<div class="sourceLine" id="cb40-8" data-line-number="8">    <span class="dt">time =</span> time <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>
</div>
<div class="sourceLine" id="cb40-9" data-line-number="9">  ) <span class="op">%&gt;%</span>
</div>
<div class="sourceLine" id="cb40-10" data-line-number="10">
<span class="st">  </span><span class="kw">group_by</span>(type) <span class="op">%&gt;%</span>
</div>
<div class="sourceLine" id="cb40-11" data-line-number="11">
<span class="st">  </span><span class="kw">ggplot</span>(., <span class="kw">aes</span>(<span class="dt">x =</span> type, <span class="dt">y =</span> time, <span class="dt">colour =</span> type)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
</div>
<div class="sourceLine" id="cb40-12" data-line-number="12">
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">stat_boxplot</span>(<span class="dt">geom =</span> <span class="st">'errorbar'</span>) <span class="op">+</span>
</div>
<div class="sourceLine" id="cb40-13" data-line-number="13">
<span class="st">    </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">wes_palette</span>(<span class="st">"GrandBudapest"</span>)) <span class="op">+</span>
</div>
<div class="sourceLine" id="cb40-14" data-line-number="14">
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">""</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">"time (sec.)"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">""</span>) <span class="op">+</span>
</div>
<div class="sourceLine" id="cb40-15" data-line-number="15">
<span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"none"</span>)</div>
<div class="sourceLine" id="cb40-16" data-line-number="16">p_estimateQ_times</div></code></pre>
<p><img src="benchmarks_hal9001_files/figure-html/hal_benchmark_drtmle_estimateQ-1.png" width="672"></p>
</section><section id="using-hal9001-with-superlearner" class="level3"><h3>Using <code>hal9001</code> with <code>SuperLearner</code>
</h3>
<p>The <code>hal9001</code> R package includes a learner wrapper for use with the <code>SuperLearner</code> R package. In order to use this learner, the user need only add “SL.hal9001” to their <code>SL.library</code> input. Here, we are interested in the difference in the performance of <code>SuperLearner</code> when the <code>hal9001</code> wrapper uses the <code>origami</code> backend versus the <code>glmnet</code> backend for the LASSO computation. To facilitate this, we create two new SL wrappers from the one included:</p>
<pre class="sourceCode r" id="cb41"><code class="sourceCode r"><div class="sourceLine" id="cb41-1" data-line-number="1">SL.hal9001.origami &lt;-<span class="st"> </span><span class="cf">function</span> (..., <span class="dt">fit_type =</span> <span class="st">"origami"</span>) {</div>
<div class="sourceLine" id="cb41-2" data-line-number="2">  <span class="kw"><a href="../reference/SL.hal9001.html">SL.hal9001</a></span>(..., <span class="dt">fit_type =</span> fit_type)</div>
<div class="sourceLine" id="cb41-3" data-line-number="3">}</div>
<div class="sourceLine" id="cb41-4" data-line-number="4"></div>
<div class="sourceLine" id="cb41-5" data-line-number="5">SL.hal9001.glmnet &lt;-<span class="st"> </span><span class="cf">function</span> (..., <span class="dt">fit_type =</span> <span class="st">"glmnet"</span>) {</div>
<div class="sourceLine" id="cb41-6" data-line-number="6">  <span class="kw"><a href="../reference/SL.hal9001.html">SL.hal9001</a></span>(..., <span class="dt">fit_type =</span> fit_type)</div>
<div class="sourceLine" id="cb41-7" data-line-number="7">}</div></code></pre>
<pre class="sourceCode r" id="cb42"><code class="sourceCode r"><div class="sourceLine" id="cb42-1" data-line-number="1">mb_hal_origami_sl_estimateG &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(<span class="dt">unit =</span> <span class="st">"s"</span>, <span class="dt">times =</span> <span class="dv">20</span>,</div>
<div class="sourceLine" id="cb42-2" data-line-number="2">  hal_origami_sl_estimateG &lt;-<span class="st"> </span><span class="kw">SuperLearner</span>(<span class="dt">Y =</span> <span class="kw">as.numeric</span>(dat<span class="op">$</span>A0 <span class="op">==</span><span class="st"> </span>abar[<span class="dv">1</span>]),</div>
<div class="sourceLine" id="cb42-3" data-line-number="3">                                           <span class="dt">X =</span> dat<span class="op">$</span>L0,</div>
<div class="sourceLine" id="cb42-4" data-line-number="4">                                           <span class="dt">SL.library =</span> <span class="kw">c</span>(<span class="st">"SL.speedglm"</span>,</div>
<div class="sourceLine" id="cb42-5" data-line-number="5">                                                          <span class="st">"SL.hal9001.origami"</span>)</div>
<div class="sourceLine" id="cb42-6" data-line-number="6">                                          )</div>
<div class="sourceLine" id="cb42-7" data-line-number="7">)</div></code></pre>
<pre><code>## Loading required package: speedglm</code></pre>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## 
## Attaching package: 'Matrix'</code></pre>
<pre><code>## The following object is masked from 'package:tidyr':
## 
##     expand</code></pre>
<pre><code>## Loading required package: MASS</code></pre>
<pre><code>## 
## Attaching package: 'MASS'</code></pre>
<pre><code>## The following object is masked from 'package:dplyr':
## 
##     select</code></pre>
<pre class="sourceCode r" id="cb50"><code class="sourceCode r"><div class="sourceLine" id="cb50-1" data-line-number="1">
<span class="kw">summary</span>(mb_hal_origami_sl_estimateG)</div></code></pre>
<pre><code>##                                                                                                                                                expr
## 1 hal_origami_sl_estimateG &lt;- SuperLearner(Y = as.numeric(dat$A0 ==      abar[1]), X = dat$L0, SL.library = c("SL.speedglm", "SL.hal9001.origami"))
##        min       lq    mean   median       uq     max neval
## 1 5.989014 6.010379 6.63428 6.058605 6.424414 10.8592    20</code></pre>
<pre class="sourceCode r" id="cb52"><code class="sourceCode r"><div class="sourceLine" id="cb52-1" data-line-number="1">mb_hal_glmnet_sl_estimateG &lt;-<span class="st"> </span><span class="kw">microbenchmark</span>(<span class="dt">unit =</span> <span class="st">"s"</span>, <span class="dt">times =</span> <span class="dv">20</span>,</div>
<div class="sourceLine" id="cb52-2" data-line-number="2">  hal_glmnet_sl_estimateG &lt;-<span class="st"> </span><span class="kw">SuperLearner</span>(<span class="dt">Y =</span> <span class="kw">as.numeric</span>(dat<span class="op">$</span>A0 <span class="op">==</span><span class="st"> </span>abar[<span class="dv">1</span>]),</div>
<div class="sourceLine" id="cb52-3" data-line-number="3">                                          <span class="dt">X =</span> dat<span class="op">$</span>L0,</div>
<div class="sourceLine" id="cb52-4" data-line-number="4">                                          <span class="dt">SL.library =</span> <span class="kw">c</span>(<span class="st">"SL.speedglm"</span>,</div>
<div class="sourceLine" id="cb52-5" data-line-number="5">                                                         <span class="st">"SL.hal9001.glmnet"</span>)</div>
<div class="sourceLine" id="cb52-6" data-line-number="6">                                         )</div>
<div class="sourceLine" id="cb52-7" data-line-number="7">)</div>
<div class="sourceLine" id="cb52-8" data-line-number="8">
<span class="kw">summary</span>(mb_hal_glmnet_sl_estimateG)</div></code></pre>
<pre><code>##                                                                                                                                              expr
## 1 hal_glmnet_sl_estimateG &lt;- SuperLearner(Y = as.numeric(dat$A0 ==      abar[1]), X = dat$L0, SL.library = c("SL.speedglm", "SL.hal9001.glmnet"))
##        min       lq     mean   median       uq      max neval
## 1 13.64942 13.94495 14.37158 14.19632 14.87847 15.54349    20</code></pre>
<pre class="sourceCode r" id="cb54"><code class="sourceCode r"><div class="sourceLine" id="cb54-1" data-line-number="1"><span class="co"># visualize</span></div>
<div class="sourceLine" id="cb54-2" data-line-number="2">p_sl_estimateG_times &lt;-<span class="st"> </span><span class="kw">rbind</span>(mb_hal_origami_sl_estimateG,</div>
<div class="sourceLine" id="cb54-3" data-line-number="3">                              mb_hal_glmnet_sl_estimateG) <span class="op">%&gt;%</span>
</div>
<div class="sourceLine" id="cb54-4" data-line-number="4">
<span class="st">  </span>data.frame <span class="op">%&gt;%</span>
</div>
<div class="sourceLine" id="cb54-5" data-line-number="5">
<span class="st">  </span><span class="kw">transmute</span>(</div>
<div class="sourceLine" id="cb54-6" data-line-number="6">    <span class="dt">type =</span> <span class="kw">ifelse</span>(<span class="kw">str_detect</span>(<span class="kw">as.character</span>(expr), <span class="st">"glmnet"</span>), <span class="st">"HAL-glmnet"</span>,</div>
<div class="sourceLine" id="cb54-7" data-line-number="7">                  <span class="st">"HAL-origami"</span>),</div>
<div class="sourceLine" id="cb54-8" data-line-number="8">    <span class="dt">time =</span> time <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>
</div>
<div class="sourceLine" id="cb54-9" data-line-number="9">  ) <span class="op">%&gt;%</span>
</div>
<div class="sourceLine" id="cb54-10" data-line-number="10">
<span class="st">  </span><span class="kw">group_by</span>(type) <span class="op">%&gt;%</span>
</div>
<div class="sourceLine" id="cb54-11" data-line-number="11">
<span class="st">  </span><span class="kw">ggplot</span>(., <span class="kw">aes</span>(<span class="dt">x =</span> type, <span class="dt">y =</span> time, <span class="dt">colour =</span> type)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
</div>
<div class="sourceLine" id="cb54-12" data-line-number="12">
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">stat_boxplot</span>(<span class="dt">geom =</span> <span class="st">'errorbar'</span>) <span class="op">+</span>
</div>
<div class="sourceLine" id="cb54-13" data-line-number="13">
<span class="st">    </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">wes_palette</span>(<span class="st">"GrandBudapest"</span>)) <span class="op">+</span>
</div>
<div class="sourceLine" id="cb54-14" data-line-number="14">
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">""</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">"time (sec.)"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">""</span>) <span class="op">+</span>
</div>
<div class="sourceLine" id="cb54-15" data-line-number="15">
<span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"none"</span>)</div>
<div class="sourceLine" id="cb54-16" data-line-number="16">p_sl_estimateG_times</div></code></pre>
<p><img src="benchmarks_hal9001_files/figure-html/hal_benchmark_drtmle_estimateG_SL-1.png" width="672"></p>
<!--

## The Binary Outcome Case



```r
# generate simple test data
n = 100
p = 3
x <- xmat <- matrix(rnorm(n * p), n, p)
y <- sin(x[, 1]) * sin(x[, 2]) + rnorm(n, 0.2)
y_bin <- as.numeric(y > median(y))
```

-->
</section></section>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#the-continuous-outcome-case">The Continuous Outcome Case</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Jeremy Coyle, Nima Hejazi.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
